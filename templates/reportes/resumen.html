{% extends "base.html" %}

{% block content %}

<h4 class="mb-3">Reportes de ventas y ganancias</h4>

<form class="row g-2 mb-4" method="get" action="/reportes">
  <div class="col-md-3">
    <label class="form-label">Desde</label>
    <input type="date" class="form-control" name="fecha_desde" value="{{ fecha_desde }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">Hasta</label>
    <input type="date" class="form-control" name="fecha_hasta" value="{{ fecha_hasta }}">
  </div>
  <div class="col-md-3 d-flex align-items-end">
    <button class="btn btn-primary">Aplicar filtro</button>
  </div>
</form>

<div class="row mb-4">
  <div class="col-md-4 mb-3">
    <div class="card border-success">
      <div class="card-body">
        <div class="text-muted mb-1">Ventas (total período)</div>
        <div class="fs-4 fw-bold">$ {{ "%0.2f"|format(total_ventas) }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-warning">
      <div class="card-body">
        <div class="text-muted mb-1">Descuentos aplicados</div>
        <div class="fs-4 fw-bold">$ {{ "%0.2f"|format(total_descuentos) }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-info">
      <div class="card-body">
        <div class="text-muted mb-1">Ganancia estimada</div>
        <div class="fs-4 fw-bold">$ {{ "%0.2f"|format(total_ganancia) }}</div>
      </div>
    </div>
  </div>
</div>

<h5 class="mb-3">Detalle por día</h5>

<table class="table table-sm table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Fecha</th>
      <th class="text-end">Pedidos</th>
      <th class="text-end">Ventas</th>
      <th class="text-end">Descuentos</th>
      <th class="text-end">Ganancia</th>
    </tr>
  </thead>
  <tbody>
  {% for r in resumen_por_dia %}
    <tr>
      <td>{{ r.fecha.strftime("%d/%m/%Y") }}</td>
      <td class="text-end">{{ r.cantidad_pedidos }}</td>
      <td class="text-end">$ {{ "%0.2f"|format(r.ventas) }}</td>
      <td class="text-end">$ {{ "%0.2f"|format(r.descuentos) }}</td>
      <td class="text-end">$ {{ "%0.2f"|format(r.ganancia) }}</td>
    </tr>
  {% else %}
    <tr>
      <td colspan="5" class="text-center text-muted">
        No hay pedidos en el período seleccionado.
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

{% endblock %}
